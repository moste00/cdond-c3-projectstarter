- name: Upgrade all packages 
  apt:
    upgrade: dist
    force_apt_get: yes

- name: "Set environment variables"
  shell: |
    cd ~/
    echo "TYPEORM_CONNECTION={{ lookup('env', 'TYPEORM_CONNECTION')}}" >> .bashrc
    echo "TYPEORM_ENTITIES={{ lookup('env', 'TYPEORM_ENTITIES')}}" >> .bashrc
    echo "TYPEORM_HOST={{ lookup('env', 'TYPEORM_HOST')}}" >> .bashrc
    echo "TYPEORM_PORT=5432" >> .bashrc
    echo "TYPEORM_USERNAME={{ lookup('env', 'TYPEORM_USERNAME')}}" >> .bashrc
    echo "TYPEORM_PASSWORD={{ lookup('env', 'TYPEORM_PASSWORD')}}" >> .bashrc
    echo "TYPEORM_DATABASE={{ lookup('env', 'TYPEORM_DATABASE')}}" >> .bashrc
    echo "TYPEORM_MIGRATIONS={{ lookup('env', 'TYPEORM_MIGRATIONS')}}" >> .bashrc
    echo "TYPEORM_MIGRATIONS_DIR={{ lookup('env', 'TYPEORM_MIGRATIONS_DIR')}}" >> .bashrc
- name: "Make sure environment variables are set"
- name: "Install nodejs"
  apt:
    name: nodejs
    state: latest
    update_cache: yes

- name: "Install npm"
  apt:
    name: npm
    state: latest
    update_cache: yes

- name: "Install pm2"
  shell: npm install pm2 -g